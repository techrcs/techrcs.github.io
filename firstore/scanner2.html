<!DOCTYPE html>
<html>
<head>
    <title>Firstore</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
  <body>
    <video id="video" autoplay></video>
    <script async>
        var shouldSend = true;
        const video = document.querySelector('#video')
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        const constraints = { 
            video: {
                facingMode: 'environment'
            },
            audio: false
        }
        navigator.mediaDevices.getUserMedia(constraints).then(stream => video.srcObject = stream);
        }

        const barcodeDetector = new BarcodeDetector({ formats: ['qr_code'] });
        
        const detectCode = () => {
        barcodeDetector.detect(video).then(codes => {
            if (codes.length === 0) return;
        
            for (const barcode of codes)  {
            console.log(barcode);
            var qr = barcode.rawValue;
            if (shouldSend){
                shouldSend = false;
                video.srcObject = null;
                window.location.replace("http://192.168.0.100:8080/webapi?screen=2&nf=" + qr);
            }
            
            }
        }).catch(err => {
            console.error(err);
        })
        }

        setInterval(detectCode, 100);
    </script>
    <style>
        body {
            background-color: #000000;
        }
        video {
            position: absolute;
            left: 50%;
            top: 50%;
            -webkit-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            max-width: 100%;
            max-height: 100%;
        }
    </style>
  </body>
</html>